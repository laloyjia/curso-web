{% extends "layout.html" %}
{% block title %}Panel de Control{% endblock %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="container section-padding" style="margin-top: 40px;">
    
    <div style="text-align: center; margin-bottom: 40px;">
        <h2>üëã Hola, {{ current_user.nombre }}</h2>
        <p style="color: #666;">Resumen de tu negocio hoy</p>
    </div>

    <div class="dashboard-grid">
        <div class="stat-card gold">
            <div class="icon">üí∞</div>
            <div class="info">
                <h3>${{ "{:,.0f}".format(total_dinero).replace(',', '.') }}</h3>
                <p>Ventas Totales</p>
            </div>
        </div>
        <div class="stat-card {% if pendientes > 0 %}alert{% endif %}">
            <div class="icon">‚è≥</div>
            <div class="info">
                <h3>{{ pendientes }}</h3>
                <p>Pedidos Pendientes</p>
            </div>
            {% if pendientes > 0 %}
            <a href="{{ url_for('admin_ordenes') }}" class="small-link">Ver &rarr;</a>
            {% endif %}
        </div>
        <div class="stat-card {% if low_stock > 0 %}danger{% endif %}">
            <div class="icon">üì¶</div>
            <div class="info">
                <h3>{{ low_stock }}</h3>
                <p>Stock Bajo</p>
            </div>
            {% if low_stock > 0 %}
            <a href="{{ url_for('admin_stock') }}" class="small-link">Reponer &rarr;</a>
            {% endif %}
        </div>
        <div class="stat-card">
            <div class="icon">üë•</div>
            <div class="info">
                <h3>{{ clientes }}</h3>
                <p>Clientes</p>
            </div>
        </div>
    </div>

    <div class="chart-section" style="margin-top: 40px; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #f0f0f0;">
        <h3 style="margin-bottom: 20px; color: #333;">üìâ Tr√°fico de Hoy (Visitas)</h3>
        <div style="position: relative; height: 300px; width: 100%;">
            <canvas id="visitsChart"></canvas>
        </div>
    </div>

    <h3 style="margin-top: 50px; margin-bottom: 20px;">Acceso R√°pido</h3>
    <div class="quick-menu">
        <a href="{{ url_for('admin_ordenes') }}" class="menu-btn"><i class="fas fa-shopping-bag"></i> Ventas</a>
        <a href="{{ url_for('admin_productos') }}" class="menu-btn"><i class="fas fa-tshirt"></i> Productos</a>
        <a href="{{ url_for('admin_stock') }}" class="menu-btn"><i class="fas fa-boxes"></i> Stock</a>
        <a href="{{ url_for('lista_usuarios') }}" class="menu-btn"><i class="fas fa-users"></i> Usuarios</a>
    </div>

</div>

<style>
    .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
    .stat-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 20px; border: 1px solid #f0f0f0; transition: transform 0.2s; position: relative; }
    .stat-card:hover { transform: translateY(-5px); }
    .stat-card.gold { border-left: 5px solid #D4AF37; }
    .stat-card.alert { border-left: 5px solid orange; background: #fffdf5; }
    .stat-card.danger { border-left: 5px solid red; background: #fff5f5; }
    .icon { font-size: 2.5rem; }
    .info h3 { margin: 0; font-size: 1.8rem; color: #333; }
    .info p { margin: 0; color: #777; font-size: 0.9rem; }
    .small-link { position: absolute; bottom: 10px; right: 15px; font-size: 0.8rem; color: #D4AF37; text-decoration: none; font-weight: bold; }
    .quick-menu { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
    .menu-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; background: white; border: 1px solid #eee; border-radius: 10px; text-decoration: none; color: #555; font-weight: bold; transition: 0.3s; }
    .menu-btn i { font-size: 1.5rem; margin-bottom: 10px; color: #D4AF37; }
    .menu-btn:hover { background: #D4AF37; color: white; }
    .menu-btn:hover i { color: white; }
</style>

<script>
    const ctx = document.getElementById('visitsChart').getContext('2d');
    const labels = {{ chart_labels | safe }};
    const data = {{ chart_data | safe }};

    const visitsChart = new Chart(ctx, {
        type: 'line', 
        data: {
            labels: labels,
            datasets: [{
                label: 'Visitantes',
                data: data,
                borderColor: '#D4AF37',
                backgroundColor: 'rgba(212, 175, 55, 0.1)',
                borderWidth: 2,
                tension: 0.4,
                fill: true,
                pointBackgroundColor: '#fff',
                pointBorderColor: '#D4AF37',
                pointRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { stepSize: 1 }
                }
            },
            plugins: {
                legend: { display: false }
            }
        }
    });
</script>
{% endblock %}